<!DOCTYPE html>
<html>
<head>
<title>06.ComunicazioneInRete.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="servizi-sicuri-per-la-comunicazione-in-rete">Servizi Sicuri per la Comunicazione in Rete</h1>
<p><a href="./README.md">Return</a></p>
<hr>
<h1 id="indice">Indice</h1>
<ul>
<li><a href="#servizi-sicuri-per-la-comunicazione-in-rete">Servizi Sicuri per la Comunicazione in Rete</a></li>
<li><a href="#indice">Indice</a>
<ul>
<li><a href="#ssl-e-tls-secure-socket-layer-e-transport-layer-security">SSL e TLS (Secure Socket Layer e Transport Layer Security)</a>
<ul>
<li><a href="#sessione-e-connessione"><strong>sessione</strong> e <strong>connessione</strong>.</a></li>
<li><a href="#come-viene-instaurata-una-sessione-ssl"><strong>Come viene instaurata una sessione SSL?</strong></a></li>
<li><a href="#tls-e-hmac-hash-based-message-authentication-code">TLS e HMAC (Hash-based Message Authentication Code)</a></li>
</ul>
</li>
<li><a href="#ipsec-internet-protocol-security">IPSec (Internet Protocol Security)</a>
<ul>
<li><a href="#servizio-di-autentticazione-ah">Servizio di Autentticazione AH</a></li>
<li><a href="#servizio-per-riservatezza-esp">Servizio per riservatezza ESP</a></li>
<li><a href="#servizio-anti-replay">Servizio anti replay</a></li>
<li><a href="#trasporto-e-tunnel-mode">Trasporto e Tunnel Mode</a></li>
<li><a href="#protocollo-ike-internet-key-exchange">Protocollo IKE (Internet Key Exchange)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ssl-e-tls-secure-socket-layer-e-transport-layer-security">SSL e TLS (Secure Socket Layer e Transport Layer Security)</h2>
<p>Ha come obiettivo quello di fornire autenticazione d'origine e riservatezza dei dati inviati all'interno di una applicazione.
Solitamente SSL viene identificato come protocollo a livello di trasporto, nonostante sia una suite di protocolli che operano da livello di applicazione a livello di trasporto.</p>
<h3 id="sessione-e-connessione"><strong>sessione</strong> e <strong>connessione</strong>.</h3>
<p>Con sessione si intendo una associazione logica tra due entità (client e server). Viene creata con li protocollo di handshake e definisce un insieme di parametri di sicurezza che saranno utilizzati per le connessioni successive.
La stessa sessione può essere utilizzata per più connessioni tra client e server.</p>
<p>Lo stato di sessione corrisponde allo stato di chiascun endpoint della sessione.</p>
<p>Lo stato di sessione è rappresentato dalle seguenti informazioni:</p>
<ul>
<li><strong>Identificatore della sessione</strong></li>
<li><strong>Certificato X.509 del peer</strong></li>
<li><strong>metodo di compressione</strong></li>
<li><strong>cifrario e algoritmo di hash</strong></li>
<li><strong>segreto principale (master secret)</strong></li>
</ul>
<p>Lo stato di connessione è invece lo stato di ciascun endpoint della connessione. È rappresentato dalle seguenti informazioni:</p>
<ul>
<li><strong>Random number:</strong> per evitare attacchi di replay</li>
<li><strong>Server write MAC key:</strong> chiave per l'integrità dei dati inviati dal server</li>
<li><strong>Client write MAC key:</strong> chiave per l'integrità dei dati inviati dal client</li>
<li><strong>Server write key:</strong> chiave per la cifratura dei dati inviati dal server</li>
<li><strong>Client write key:</strong> chiave per la cifratura dei dati inviati dal client</li>
<li><strong>Vettore di inizializzazione:</strong> per la cifratura dei dati inviati dal server e dal client</li>
<li><strong>Sequence number:</strong> per ogni messaggio trasmesso e ricevuto viene memorizzato da entrambi il numero di sequenza.</li>
</ul>
<h3 id="come-viene-instaurata-una-sessione-ssl"><strong>Come viene instaurata una sessione SSL?</strong></h3>
<ol>
<li>Il client invia un messaggio di <strong>Client Hello</strong> al server, contenente:
<ul>
<li>Versione del protocollo SSL/TLS supportata</li>
<li>Lista dei cifrari supportati</li>
<li>Numero casuale generato dal client
Il server risponde con un messaggio di <strong>Server Hello</strong>, contenente:</li>
<li>Versione del protocollo SSL/TLS scelta</li>
<li>Cifrario scelto</li>
<li>Numero casuale generato dal server
La fase consente di stabilire le versioni del protocollo e i cifrari da utilizzare per la sessione.</li>
</ul>
</li>
<li>Il server invia il suo certificato X.509 al client, che lo verifica per autenticare il server.
<ul>
<li>Il client verifica la validità del certificato, ma non se questo è stato revocato. Quindi SSL può essere utilizzato se non è fondamentale il non ripudio.
Avviene quindi lo scambio delle chiavi che permette a regime di cifrare e avere autenticazione dei messaggi.</li>
</ul>
</li>
<li>Avviene l'accordo sul segreto principale, e eventualmente l'autenticazione del client (non obbligatoria).</li>
<li>chiude il protocollo e controlla che tutti i dati siano stati inviati correttamente e integralmente. A questo punto tocca al protocollo recordo proteggere i dati scambiati tra client e server.</li>
</ol>
<p>Stabilita una <strong>socket</strong> fra client e server viene garantita l'autenticazione dell'origine e ridervatezza. Terminato questo protocollo è possibile instaurare le conneessioni.</p>
<p>Vediamo i protocolli di cui fa uso TLS:</p>
<ul>
<li><strong>Handshake Protocol:</strong> per stabilire una sessione sicura e autenticare le parti coinvolte.</li>
<li><strong>Alert Protocol:</strong> per segnalare errori o condizioni particolari durante la comunicazione.</li>
<li><strong>Change Cipher Spec Protocol:</strong> per notificare il cambio di cifratura.</li>
<li><strong>Record Protocol:</strong> per incapsulare i dati applicativi e garantire la loro integrità e riservatezza.</li>
</ul>
<h3 id="tls-e-hmac-hash-based-message-authentication-code">TLS e HMAC (Hash-based Message Authentication Code)</h3>
<p>SSL/TLS non utilizzano la firma digitale ma HMAC (Hash-based Message Authentication Code) per garantire l'integrità e l'autenticità dei messaggi. Questo non garantisce il non ripudio, ma è sufficiente per la maggior parte delle applicazioni.</p>
<p>È stato scelto per la sua efficienza e per la capacità di resistere ad attacchi di tipo collisione, che sono più probabili con le firme digitali tradizionali.</p>
<h2 id="ipsec-internet-protocol-security">IPSec (Internet Protocol Security)</h2>
<p>A livello di rete viene utilizzato IPv4 che però è soggetto a:</p>
<ul>
<li><strong>Packet Sniffing:</strong> intercettazione dei pacchetti di rete.</li>
<li><strong>IP Spoofing:</strong> falsificazione dell'indirizzo IP di origine.</li>
<li><strong>Connection Hijacking:</strong> presa di controllo di una connessione esistente.</li>
<li><strong>Clogging:</strong> saturazione della rete con pacchetti inutili.</li>
</ul>
<p>Per questo si utilizza IPSec (Internet Protocol Security), un insieme di protocolli per la sicurezza delle comunicazioni IP per garantire:</p>
<ul>
<li><strong>integrità dei datagrammi</strong></li>
<li><strong>autenticazione dell'origine dei datagrammi</strong></li>
<li><strong>scarto dei pacchetti prodotti da un replay attack</strong></li>
<li><strong>confidenzialità dei dati</strong></li>
<li>*<strong>condifenzialità parziale del traffico IP</strong></li>
</ul>
<p>IPSec può quindi essere definito come una architettura per dare sicurezza al livello IP.</p>
<p>I protocolli IPSec sono:</p>
<ul>
<li><strong>AH (Authentication Header):</strong> fornisce autenticazione e integrità dei dati, ma non cifratura.</li>
<li><strong>ESP (Encapsulating Security Payload):</strong> fornisce autenticazione, integrità e cifratura dei dati.</li>
<li><strong>IKE (Internet Key Exchange):</strong> per la negoziazione delle chiavi e l'autenticazione tra i peer.</li>
</ul>
<p>IPSec prevede delle entità per realizzare i servizi:</p>
<ul>
<li><strong>SPD (Security Policy Database):</strong> definisce le politiche di sicurezza per i flussi di traffico, esamina i pacchetti in ingresso e in uscita e decide se applicare o meno i servizi di sicurezza.</li>
<li><strong>SAD (Security Association Database):</strong> contiene le associazioni di sicurezza attive, che definiscono le chiavi e i parametri di sicurezza per i flussi di traffico.</li>
<li><strong>SA (Security Association):</strong> è un accordo tra due entità per utilizzare un insieme di servizi di sicurezza, come autenticazione, integrità e cifratura. Ogni SA è identificata da:
<ul>
<li><strong>SPI (Security Parameter Index):</strong> un identificatore univoco per la SA.</li>
<li><strong>Indirizzo IP del peer:</strong> l'indirizzo IP della controparte con cui si sta comunicando.</li>
<li><strong>Protocollo di sicurezza:</strong> AH o ESP.</li>
</ul>
</li>
</ul>
<p>all'interno dell'<strong>SA</strong> troviamo:</p>
<ul>
<li><strong>contatore del numero di sequenza:</strong> per prevenire attacchi di replay.</li>
<li><strong>finestra anti replay:</strong> per limitare il numero di pacchetti che possono essere accettati in un determinato intervallo di tempo.</li>
<li><strong>informazioni relative a AH</strong></li>
<li><strong>informazioni relative a ESP</strong></li>
<li><strong>durata della associazione di sicurezza:</strong> per limitare la validità della SA nel tempo.</li>
<li><strong>modalità operativa di IPSec:</strong> può essere in modalità tunnel o trasporto.
<ul>
<li><strong>Modalità tunnel:</strong> cifra l'intero pacchetto IP, creando un nuovo pacchetto con un nuovo header IP. Utilizzata per VPN e comunicazioni tra reti.</li>
<li><strong>Modalità trasporto:</strong> cifra solo il payload del pacchetto IP, mantenendo l'header originale. Utilizzata per comunicazioni end-to-end tra host.</li>
</ul>
</li>
<li><strong>Path MTU (Maximum Transmission Unit):</strong> per evitare la frammentazione dei pacchetti durante la trasmissione.</li>
</ul>
<p>Il messaggio segue il seguente percorso:</p>
<ol>
<li>Il messaggio viene incapsulato in un pacchetto IP.</li>
<li>Viene scelta la politica di sicurezza dal SPD.</li>
<li>Viene creata una SA dal SAD.</li>
<li>Viene applicato il servizio di sicurezza scelto (AH o ESP).</li>
<li>Il pacchetto viene inviato attraverso la rete.</li>
</ol>
<h3 id="servizio-di-autentticazione-ah">Servizio di Autentticazione AH</h3>
<p>L'autenticazione tramite AH viene garantito creando un hash con HMAC a partire dal pacchetto IP. Sono garantite quindi autenticazione e integrità.</p>
<h3 id="servizio-per-riservatezza-esp">Servizio per riservatezza ESP</h3>
<p>Il pacchetto IP viene cifrato con una chiave segreta condivisa tra le due entità. Viene quindi creato un nuovo pacchetto IP con un header ESP che contiene le informazioni di autenticazione e integrità.</p>
<h3 id="servizio-anti-replay">Servizio anti replay</h3>
<p>il servizio anti replay viene realizzato tramite il sequence number field. Viene utilizzata una finestra scorrevole. Ogni pacchetto ha un numero di sequenza unico, e il ricevente mantiene una finestra di sequenza per tenere traccia dei pacchetti ricevuti. Se un pacchetto con un numero di sequenza già ricevuto viene ricevuto nuovamente, viene scartato come replay attack.</p>
<h3 id="trasporto-e-tunnel-mode">Trasporto e Tunnel Mode</h3>
<p>In modalità trasporto, il payload del pacchetto IP viene cifrato, ma l'header IP originale rimane intatto. Questo consente di mantenere le informazioni di routing e di indirizzamento originali.
In modalità tunnel, l'intero pacchetto IP viene cifrato e incapsulato in un nuovo pacchetto IP con un nuovo header. Questo consente di creare una &quot;tunnelizzazione&quot; tra due reti, nascondendo completamente le informazioni originali del pacchetto.</p>
<h3 id="protocollo-ike-internet-key-exchange">Protocollo IKE (Internet Key Exchange)</h3>
<p>Il protocollo IKE viene utilizzato per negoziare le chiavi e le associazioni di sicurezza tra due entità. Si basa su un processo di scambio di messaggi che consente di stabilire una SA sicura.</p>
<p>Il protocollo IKE è composto di tre protocolli:</p>
<ul>
<li><strong>ISAKMP (Internet Security Association and Key Management Protocol):</strong> definisce il framework per la negoziazione delle associazioni di sicurezza e la gestione delle chiavi.</li>
<li><strong>Oakley:</strong> definisce gli algoritmi di scambio delle chiavi e le modalità di autenticazione.</li>
<li><strong>SKEME (Secure Key Exchange Mechanism):</strong> fornisce meccanismi di scambio delle chiavi sicuri.</li>
</ul>
<p>Il processo di IKE avviene in due fasi:</p>
<ol>
<li><strong>Fase 1:</strong> stabilisce una SA sicura tra i due peer, utilizzando l'autenticazione e lo scambio delle chiavi. Viene creata una SA IKE che protegge le comunicazioni tra i peer durante la negoziazione delle associazioni di sicurezza.</li>
<li><strong>Fase 2:</strong> negozia le associazioni di sicurezza specifiche per i servizi di sicurezza desiderati (AH o ESP). Viene creata una SA IPSec che protegge le comunicazioni tra i peer.</li>
</ol>

</body>
</html>
